<?php
if(!isset($config['dmods2'])){
	$config['dmods2']['modules'] = array (
		'Dante(0.12.3)' => 
		array (
			'link' => 'http://download.botdom.com/3o7ye/Dante%200.12.3.zip',
			'by' => 'NarratorOfTownsville',
		),
		'Colorcheck' => 
		array (
			'link' => 'http://download.botdom.com/ap7au/colors.zip',
			'by' => 'Wizard-Kgalm',
		),
		'Contra(5.3)' => 
		array (
			'link' => 'http://download.botdom.com/mwpjf/Contra_5.3_public.zip',
			'by' => 'photofroggy',
		),
		'Dice' => 
		array (
			'link' => 'http://download.botdom.com/28qs7/dice_for_dante.zip',
			'by' => 'tharglet',
		),
		'Dios' => 
		array (
			'link' => 'http://download.botdom.com/tx897/dios.zip',
			'by' => 'Magaman',
		),
		'Gold' => 
		array (
			'link' => 'http://download.botdom.com/bodli/Gold.zip',
			'by' => 'goldenskl',
		),
		'Input(0.10)' => 
		array (
			'link' => 'http://download.botdom.com/ux77i/input%20for%200.10%20SVN.zip',
			'by' => 'Wizard-Kgalm',
		),
		'Magician(4.0)' => 
		array (
			'link' => 'http://download.botdom.com/opmfh/Magician4.0.zip',
			'by' => 'Wizard-Kgalm',
		),
		'Maltriv' => 
		array (
			'link' => 'http://download.botdom.com/x2gyh/Maltriv_1.7_dante09abeta.zip',
			'by' => 'photofroggy',
		),
		'News' => 
		array (
			'link' => 'http://download.botdom.com/eq4ow/news_for_dante.zip',
			'by' => 'tharglet',
		),
		'Platinum' => 
		array (
			'link' => 'http://download.botdom.com/vsacr/platinum.zip',
			'by' => 'Milotic1406',
		),
		'Pokezap' => 
		array (
			'link' => 'http://download.botdom.com/virsu/pokezap_1.0_for_dante.zip',
			'by' => 'tharglet',
		),
		'Translate' => 
		array (
			'link' => 'http://download.botdom.com/0tfw5/translate.zip',
			'by' => 'Frozen-Jakalope',
		),
		'Trivia' => 
		array (
			'link' => 'http://download.botdom.com/zyc9z/Trivia.zip',
			'by' => 'Solitude12',
		),
		'Urban_Dictionary' => 
		array (
			'link' => 'http://download.botdom.com/rdy0b/ud.php',
			'by' => 'Frozen-Jakalope',
		),
		'Vend_fix' => 
		array (
			'link' => 'http://download.botdom.com/tsd82/vend_fix_for_dante.zip',
			'by' => 'tharglet',
		),
		'YouTube' => 
		array (
			'link' => 'http://download.botdom.com/8tdz1/youtube_1.5.zip',
			'by' => 'Kakashi-Sasuke',
		),
		'badwords' => 
		array (
			'link' => 'http://download.botdom.com/aedcc/badwords_for_dante_1.5.zip',
			'by' => 'tharglet',
		),
		'calc' => 
		array (
			'link' => 'http://download.botdom.com/1hcyl/calc.zip',
			'by' => 'doofsmack',
		),
		'define' => 
		array (
			'link' => 'http://download.botdom.com/xhrev/searches_fix_1.0_for_dante.zip',
			'by' => 'tharglet',
		),
		'echochan' => 
		array (
			'link' => 'http://download.botdom.com/8er4r/echochan_1.0_for_dante.zip',
			'by' => 'tharglet',
		),
		'firewall' => 
		array (
			'link' => 'http://download.botdom.com/9djm3/firewall.zip',
			'by' => 'furrylover105',
		),
		'howlong' => 
		array (
			'link' => 'http://download.botdom.com/poy4y/howlong_for_dante.zip',
			'by' => 'tharglet',
		),
		'kickcounter' => 
		array (
			'link' => 'http://download.botdom.com/aw2my/kickcounter_1.0_for_Dante.zip',
			'by' => 'tharglet',
		),
		'kicktrivia' => 
		array (
			'link' => 'http://download.botdom.com/2ibpn/kicktrivia_1.1_for_dante.zip',
			'by' => 'tharglet',
		),
		'last.fm' => 
		array (
			'link' => 'http://download.botdom.com/rlx34/lastfm.zip',
			'by' => 'Frozen-Jakalope',
		),
		'note_fix' => 
		array (
			'link' => 'http://download.botdom.com/ehtts/notes_fix_for_dante.zip',
			'by' => 'SubjectX52873M',
		),
		'promoteme' => 
		array (
			'link' => 'http://download.botdom.com/jf3ja/promoteme_1.0_for_dante.zip',
			'by' => 'tharglet',
		),
		'rsay' => 
		array (
			'link' => 'http://download.botdom.com/0e66g/rsay_for_dante.zip',
			'by' => 'tharglet',
		),
		'seen' => 
		array (
			'link' => 'http://download.botdom.com/391qo/Scripts_Package_for_Dante.zip',
			'by' => 'tharglet',
		),
		'spamkick' => 
		array (
			'link' => 'http://download.botdom.com/0x8th/spamkick.zip',
			'by' => 'Milotic1406',
		),
		'timelog' => 
		array (
			'link' => 'http://download.botdom.com/7l9w8/timelog_for_dante.zip',
			'by' => 'tharglet',
		),
		'zapper' => 
		array (
			'link' => 'http://download.botdom.com/bdcib/zapper_1.0_for_dante.zip',
			'by' => 'tharglet',
		),
		'llama_giver' =>
		array (
			'link' => 'http://download.botdom.com/p6p11/llama.zip',
			'by' => 'Wizard-Kgalm',
		),
	);
	$config['dmods'] = $config['dmods2'];
	save_config('dmods');
	save_config('dmods2');
}
if(!isset($config['dmods']['modules'])){
	$config['dmods'] = $config['dmods2'];
	save_config('dmods');
	$dAmn->say("$from: Dmods list updated successfully.",$c);
}
switch ($args[0]){
	case "dmods":
		switch($args[1]){
			case "add":
				if(!empty($args[2])){
					if(!empty($args[3])){
						if(!empty($args[4])){
							$dmods = array('name'=>$args[2], 'link'=>$args[3], 'by'=>$args[4],);
						}else
							$dmods = $dmods = array('name'=>$args[2], 'link'=>$args[3],);
						$moo = false;
						foreach($config['dmods']['modules'] as $id => $mod){ $mock = $mod[0]; 
							if(strtolower($mock) == strtolower($args[2])){
								$moo = true;
							}
						}
						if(!$moo){
							$config['dmods']['modules'][$dmods['name']]['link'] = $dmods['link'];
							if(isset($dmods['by'])){
								$config['dmods']['modules'][$dmods['name']]['by'] = $dmods['by'];
							}
							ksort($config['dmods']['modules']);
							save_config('dmods');
								$dAmn->say("$from: $args[2] has been successfully added!",$c);
						}else
							$dAmn->say("$from: $args[2] has already been added!",$c);
					}else
						$dAmn->say("$from: You must provide a download link to the module to add it.",$c);
				}else
					$dAmn->say("$from: Usage:{$tr}dmods add <i>module</i>.",$c);
				break;
			case "del":
			case "delete":
			case "remove":
				if(isset($config['dmods'])){
					if(empty($args[2])){	
						return $dAmn->say("$from: You must include the name of the module you want to delete.",$c);
					}
					$remove = FALSE;
					foreach($config['dmods']['modules'] as $name => $info){
						if(strtolower($name) === strtolower($args[2])){
							unset($config['dmods']['modules'][$name]);
							ksort($config['dmods']['modules']);
							save_config('dmods');
							$remove = TRUE;
						}
					}
					if($remove){
						$dAmn->say("$from: $args[2] has been removed from the list!",$c);
					}else
						$dAmn->say("$from: $args[2] was not found on the list. Check to make sure it exists using {$tr}dmods check <i>name</i>",$c); 
				}else
					return $dAmn->say("$from: There aren't any modules stored yet.",$c);
				break;
			case "change":
				if($args[2] !=""){
					if(!isset($config['dmods']['modules'][$args[2]])){
						return $dAmn->say($f ."$args[2] was not found on the list. Type {$tr}dmods list to see the full list of names.",$c);
					}
					if($args[3] !=""){
						$config['dmods']['modules'][$args[2]]['link'] = $args[3];
						save_config('dmods');
						$dAmn->say($f ."Download link successfully updated.",$c);
					}else
						$dAmn->say($f ."You need to provide a link to change the current one to.",$c);
				}else
					$dAmn->say($f ."You need the name of a module and a download link to change that module's download link to.",$c);
				break;
			case "change2":
				if($args[2] !=""){
					if(!isset($config['dmods']['modules'][$args[2]])){
						return $dAmn->say($f ."$args[2] was not found. {$tr}dmods list will display a list of all the available modules.",$c);
					}
					if($args[3] !=""){
						$config['dmods']['modules'][$args[2]]['by'] = $args[3];
						save_config('dmods');$dAmn->say($f ."Author successfully updated.",$c);
					}else
						$dAmn->say($f ."You need to provide an author to change the current one to.",$c);
				}else
					$dAmn->say($f ."You need the name of a module and the name of the author of that module to change this.",$c);
					break;
			case "rname":
				if(!empty($args[2])){
					if(!empty($args[3])){
						foreach($config['dmods']['modules'] as $id => $mod){
							if(strtolower($id) == strtolower($args[2])){
								$config['dmods']['modules'][$args[3]] = $config['dmods']['modules'][$id];
								unset($config['dmods']['modules'][$id]);
								save_config('dmods');
								$founding = TRUE;
							}
						}
						if($founding){
							$dAmn->say("$from: Module $args[2] has been renamed $args[3]!",$c);
						}else
							$dAmn->say("$from: Module $args[2] could not be found.",$c);
					}else
						$dAmn->say("$from: You must provide a name to rename the module to.",$c);
				}else
					$dAmn->say("$from: Usage: {$tr}dmods rname <i>modulename <b>RENAME</b></i>.",$c);
				break;
			case "list":
				$say="";
				if(!empty($config['dmods'])){
					if($args[2] == ""){
						$say .="The Modules stored are: <br/><sup>";
						foreach($config['dmods']['modules'] as $id => $mod){
							$say .="[".$id."] ";
						}
						$dAmn->say($say,$c);
					}else
					if($args[2] == "links"){
						$say .="The Modules you have stored on here are: <br/><sup>";
						foreach($config['dmods']['modules'] as $id => $mod){
							$say .="[{$id} {$config['dmods']['modules'][$id]['link']}]  ";
						}
						$dAmn->say($say,$c);
					}else
					if($args[2] == "all"){
						$say .="The Modules you have stored on here are: <br/><sup>";
						foreach($config['dmods']['modules'] as $id => $mod){
						$say .=" [{$id} {$config['dmods']['modules'][$id]['link']} {$config['dmods']['modules'][$id]['by']}] <br> ";
						}
						$dAmn->say($say,$c);
					}
				}else
					$dAmn->say("$from: There aren't any modules stored.",$c);
				break;
			case "check":
				if(!empty($config['dmods'])){
					if($args[2] !=""){
						$finding = FALSE;
						foreach($config['dmods']['modules'] as $id => $mod){
							if(strtolower($id) == strtolower($args[2])){
								$finding = TRUE;
								$link= $config['dmods']['modules'][$id]['link'];
								$by = $config['dmods']['modules'][$id]['by'];
								$name = $id;
							}
						}
						if($finding){
							if(isset($by)){
								$dAmn->say("$from: <b><a href=\"".$link."\" title=\"{$name}\">{$name}</a></b> by :dev{$by}:",$c);
							}else
								$dAmn->say("$from: <b><a href=\"".$link."\" title=\"{$name}\">{$name}</a></b>",$c);
						}else
							$dAmn->say("$from: No {$args[2]} module exists.",$c);
					}else
						$dAmn->say("$from: Usage: {$tr}dmods check <i>NAME</i>",$c);
				}else
					$dAmn->say("$from: You have no mods stored.",$c);
				break; // The below was my attempt at pulling the links directly from the page. Didn't go well. Haha. Or at least, I don't remember it going well.
			/*case "hidden": //Also made worthless by that asshole DeathShadow--666, because he removed all links. 
				$testinfo = @file_get_contents("http://botdom.com/wiki/Dante_modules");
				preg_match_all("/plainlinks devart\" title=\"(.*)\"/Ums", $testinfo, $matches);
				$config['dtest']['info'] = $matches;
				foreach($config['dtest']['info'][1] as $number => $names){
					$names = substr($names,8);
					$config['dtest']['info'][1][$number] = $names;
				}
				preg_match_all("/external text\" title=\"(.*)\"/Ums", $testinfo, $matches2);
				unset($config['dtest']['links']);
				foreach($matches2[1] as $number => $links){
					$disgard = FALSE;
					foreach($config['dtest']['links'] as $number => $link){
						if($links == $link){
							$disgard = TRUE;
						}
					}
					if(!$disgard){
						if(stristr($links, "http://download")){
							$config['dtest']['links'][] = $links;
						}
					}
					
				}
				save_config('dtest');
				//preg_match("/gmi-name=\"(.*)\"/Ums", $devpage, $matches);
				break;
			*/
			default: 
				$say="";
				if(!empty($config['dmods'])){
					$say .= "These are the modules for Dante:<br><sup>";
					$i = 0;
					foreach($config['dmods']['modules'] as $id => $mod){
						$link = $config['dmods']['modules'][$id]['link'];
						$by = $config['dmods']['modules'][$id]['by'];
						if(isset($by)){
							$say .= "[<a href=\"".$link."\" title=\"{$id} by {$by}\">{$id}</a>] "; 
						}else{
							$say .= "[<a href=\"".$link."\" title=\"{$id}\">{$id}</a>] ";
						}
					}
					$dAmn->say($say,$c);
				}else
					$dAmn->say("$from: To get started, type {$tr}dmods add [module name] [download link] [by] to add a module. Leave by blank if you don't know who the author is.",$c);
				break;
		}
		break;
}